<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Nexus Pro | AI Assistant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root {
            --primary: #00f2fe;
            --secondary: #8b5cf6;
            --bg: #020617;
            --card: #0f172a;
            --border: rgba(255, 255, 255, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: white; min-height: 100vh; overflow-x: hidden; }

        /* UI Shell */
        nav { padding: 1rem; display: flex; justify-content: space-between; align-items: center; background: rgba(2, 6, 23, 0.9); backdrop-filter: blur(15px); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--border); }
        .logo { font-size: 1.2rem; font-weight: 900; background: linear-gradient(90deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        #portal-page { display: none; padding: 15px; max-width: 800px; margin: 0 auto; animation: fadeIn 0.4s ease; }
        #landing-page { padding: 80px 20px; text-align: center; }

        /* Chat UI */
        .panel { background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 20px; }
        #chat-box { height: 450px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; margin-bottom: 15px; scroll-behavior: smooth; padding-bottom: 10px; }
        
        .msg { padding: 14px 18px; border-radius: 20px; font-size: 16px; max-width: 85%; line-height: 1.5; position: relative; }
        .msg.bot { background: #1e293b; align-self: flex-start; border-bottom-left-radius: 4px; border-left: 3px solid var(--primary); }
        .msg.user { background: var(--secondary); align-self: flex-end; border-bottom-right-radius: 4px; }

        /* Artifacts (Live Preview) */
        .artifact { background: white; border-radius: 12px; margin-top: 12px; overflow: hidden; border: 4px solid #334155; }
        .preview-label { background: #334155; color: white; font-size: 11px; padding: 4px 10px; text-transform: uppercase; font-weight: bold; }
        iframe { width: 100%; height: 300px; border: none; }

        /* Input Area */
        .input-container { display: flex; gap: 10px; background: #000; padding: 10px; border-radius: 20px; border: 1px solid var(--border); }
        input { flex: 1; background: transparent; border: none; color: white; font-size: 16px; outline: none; padding-left: 10px; }
        #sendBtn { background: var(--primary); color: #000; width: 44px; height: 44px; border-radius: 15px; border: none; font-size: 20px; font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <nav>
        <div class="logo">NEXUS PRO</div>
        <button id="connectBtn" style="background:none; border:1px solid var(--border); color:white; padding:8px 15px; border-radius:10px;">Connect</button>
    </nav>

    <section id="landing-page">
        <h1 style="font-size: 2.5rem; margin-bottom: 10px;">Nexus Sovereign</h1>
        <p style="color:#64748b; margin-bottom: 40px;">The Conversational Web3 Builder</p>
        <div style="background:var(--card); padding:30px; border-radius:24px; max-width:350px; margin:0 auto; border:1px solid var(--border);">
            <div style="font-size:2.5rem; font-weight:800; margin-bottom:15px;">0.0005 ETH</div>
            <button id="payBtn" style="width:100%; padding:15px; border-radius:12px; background:var(--primary); border:none; font-weight:bold;">INITIALIZE SYSTEM</button>
        </div>
    </section>

    <section id="portal-page">
        <div class="panel">
            <div id="chat-box">
                <div class="msg bot">Nexus AI initialized. I can chat about your project or build a website for you instantly. What's on your mind?</div>
            </div>
            <div class="input-container">
                <input type="text" id="chatInput" placeholder="Chat or ask 'Make a website about...'" autocomplete="off">
                <button id="sendBtn">âž”</button>
            </div>
        </div>
    </section>

    <script>
        const ADMIN_WALLET = "0x02f93c7547309ca50EEAB446DaEBE8ce8E694cBb";
        const DESTINATION = "0x02f93c7547309ca50EEAB446DaEBE8ce8E694cBb";
        const AMOUNT = "0.0005";

        const chatBox = document.getElementById('chat-box');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const portalPage = document.getElementById('portal-page');
        const landingPage = document.getElementById('landing-page');

        let userAddress;

        // --- CORE AI LOGIC ---
        function getAIResponse(input) {
            const query = input.toLowerCase();
            
            // 1. CHECK IF BUILD COMMAND
            if (query.includes("make") || query.includes("build") || query.includes("create") || query.includes("website")) {
                const topic = query.replace(/make|build|create|website|a|about|for|me/gi, "").trim() || "My Project";
                return {
                    type: "build",
                    text: `Certainly. I'm spinning up a custom deployment for **${topic}**. Check the live preview below:`,
                    code: `
                        <html>
                        <body style="margin:0; font-family:sans-serif; background:#f8fafc; color:#0f172a; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; text-align:center;">
                            <div style="padding:40px; background:white; border-radius:20px; box-shadow:0 10px 25px rgba(0,0,0,0.05);">
                                <h1 style="color:#8b5cf6; font-size:32px;">${topic}</h1>
                                <p style="color:#64748b; font-size:18px;">Created by Nexus AI Sovereign</p>
                                <button style="margin-top:20px; padding:12px 24px; border:none; background:#00f2fe; border-radius:10px; font-weight:bold;">Explore Now</button>
                            </div>
                        </body>
                        </html>
                    `
                };
            }

            // 2. GENERAL CONVERSATION
            const smallTalk = {
                "hi": "Hello Operator. Systems are nominal. How can I help you build today?",
                "hello": "Greetings. Ready for deployment instructions.",
                "who are you": "I am Nexus Sovereign, an AI agent optimized for Web3 development and on-chain intelligence.",
                "help": "I can build websites from scratch or answer questions about your current project. Just ask!",
                "thanks": "You're welcome. Let's keep building.",
                "ok": "Acknowledged. Standing by for your next command."
            };

            return {
                type: "chat",
                text: smallTalk[query] || "That's an interesting perspective. I'm recording that into our project context. Should we build something based on that?"
            };
        }

        function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            // Add User Message
            const userMsg = document.createElement('div');
            userMsg.className = 'msg user';
            userMsg.innerText = text;
            chatBox.appendChild(userMsg);
            chatInput.value = "";
            chatBox.scrollTop = chatBox.scrollHeight;

            // Process AI Response
            setTimeout(() => {
                const response = getAIResponse(text);
                
                // Add AI Text
                const botMsg = document.createElement('div');
                botMsg.className = 'msg bot';
                botMsg.innerHTML = response.text;
                chatBox.appendChild(botMsg);

                // Add Artifact if it's a build
                if (response.type === "build") {
                    const art = document.createElement('div');
                    art.className = 'artifact';
                    art.innerHTML = `
                        <div class="preview-label">Live Preview</div>
                        <iframe srcdoc='${response.code}'></iframe>
                    `;
                    chatBox.appendChild(art);
                }
                
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 600);
        }

        // --- BUTTONS & KEYS ---
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });

        // --- WALLET AUTH ---
        async function handleAuth() {
            if (window.ethereum) {
                const accs = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAddress = accs[0];
                if (userAddress.toLowerCase() === ADMIN_WALLET.toLowerCase() || confirm("Payment simulation: 0.0005 ETH confirmed?")) {
                    landingPage.style.display = "none";
                    portalPage.style.display = "block";
                }
            }
        }
        document.getElementById('payBtn').addEventListener('click', handleAuth);
    </script>
</body>
</html>
