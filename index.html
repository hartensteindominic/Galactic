<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Sovereign V4</title>
    <style>
        :root { --bg: #0d0d0d; --surface: #1a1a1a; --border: #2d2d2d; --accent: #00ffcc; --text: #d1d1d1; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--text); font-family: 'SF Mono', 'Fira Code', monospace; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* MINIMALIST NAV */
        nav { height: 50px; border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 20px; justify-content: space-between; background: var(--bg); }
        .logo { font-size: 14px; font-weight: bold; letter-spacing: 2px; color: #fff; }
        .status { font-size: 10px; color: var(--accent); text-transform: uppercase; display: flex; align-items: center; gap: 8px; }
        .dot { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 8px var(--accent); }

        /* WORKSPACE LAYOUT */
        main { display: flex; flex: 1; overflow: hidden; }
        #editor-side { flex: 1; display: flex; flex-direction: column; border-right: 1px solid var(--border); }
        #preview-side { flex: 1.2; background: #fff; position: relative; }
        
        /* THE FORGE (EDITOR) */
        textarea { flex: 1; background: transparent; color: var(--accent); border: none; padding: 20px; font-size: 13px; outline: none; resize: none; line-height: 1.6; }
        
        /* CONSOLE & CONTROLS */
        .terminal-footer { background: var(--surface); border-top: 1px solid var(--border); padding: 12px; display: flex; gap: 10px; align-items: center; }
        .cmd-input { flex: 1; background: #000; border: 1px solid var(--border); padding: 8px 12px; color: #fff; font-size: 12px; border-radius: 4px; outline: none; }
        .cmd-input:focus { border-color: var(--accent); }
        .btn { background: var(--accent); color: #000; border: none; padding: 8px 16px; font-size: 11px; font-weight: 900; cursor: pointer; border-radius: 4px; text-transform: uppercase; }
        .btn:hover { opacity: 0.8; }
        .btn-secondary { background: transparent; color: #777; border: 1px solid var(--border); }

        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <nav>
        <div class="logo">NEXUS_SOVEREIGN_V4</div>
        <div class="status"><div class="dot" id="dot"></div> <span id="status-text">SYSTEM_READY</span></div>
    </nav>

    <main>
        <section id="editor-side">
            <textarea id="code-editor" spellcheck="false" placeholder="// Paste code here or use command below..."></textarea>
            <div class="terminal-footer">
                <input type="text" id="ai-cmd" class="cmd-input" placeholder="Enter rewrite command (e.g. 'Add a dark mode toggle')...">
                <button class="btn" id="run-btn">EXECUTE</button>
                <button class="btn btn-secondary" id="undo-btn">UNDO</button>
            </div>
        </section>
        <section id="preview-side">
            <iframe id="live-preview"></iframe>
        </section>
    </main>

    <script>
        const editor = document.getElementById('code-editor');
        const preview = document.getElementById('live-preview');
        const cmdInput = document.getElementById('ai-cmd');
        const statusText = document.getElementById('status-text');
        const dot = document.getElementById('dot');
        
        let history = [];
        const XAI_KEY = "Xai-G7JvL16cDlnBbKrHUxKcwEcsexkOTgFP2phHhGGbkM3ug4uLI2pajIDncuAG3E4IhVyKXVVnrOBglVCs";

        // REAL-TIME SYNC
        editor.addEventListener('input', () => {
            const blob = new Blob([editor.value], { type: 'text/html' });
            preview.src = URL.createObjectURL(blob);
        });

        async function executeRewrite() {
            const task = cmdInput.value.trim();
            if (!task) return;

            statusText.innerText = "EXECUTING_RECURSIVE_TASK...";
            dot.style.background = "#ffcc00"; // Warning yellow during processing
            
            try {
                const response = await fetch("https://api.x.ai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${XAI_KEY}` },
                    body: JSON.stringify({
                        model: "grok-4",
                        messages: [
                            { role: "system", content: "You are a professional web engineer. Rewrite the code precisely. Return ONLY the HTML/CSS/JS code." },
                            { role: "user", content: `SOURCE:\n${editor.value}\n\nTASK:\n${task}` }
                        ]
                    })
                });

                const data = await response.json();
                let result = data.choices[0].message.content;
                result = result.replace(/```html|```/g, "").trim();

                history.push(editor.value);
                editor.value = result;
                editor.dispatchEvent(new Event('input'));
                
                statusText.innerText = "TASK_COMPLETE";
                dot.style.background = "#00ffcc";
                cmdInput.value = "";
            } catch (e) {
                statusText.innerText = "EXECUTION_ERROR";
                dot.style.background = "#ff3333";
            }
        }

        document.getElementById('run-btn').onclick = executeRewrite;
        cmdInput.addEventListener('keypress', (e) => { if(e.key === 'Enter') executeRewrite(); });
        document.getElementById('undo-btn').onclick = () => {
            if (history.length > 0) {
                editor.value = history.pop();
                editor.dispatchEvent(new Event('input'));
            }
        };
    </script>
</body>
</html>
