<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Galactic Bazaar – Keyboard Only</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; font-family: Arial, sans-serif; color: #0f8; }
    #ui {
      position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 12px; border-radius: 8px;
      font-size: 16px; pointer-events: none;
    }
    #inventory {
      position: absolute; top: 10px; right: 10px; background: rgba(0,20,40,0.8); padding: 12px; border-radius: 8px;
      font-size: 18px; min-width: 180px;
    }
    #trade-msg {
      position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.8); color: #ffeb3b; font-size: 26px; padding: 16px 32px;
      border-radius: 12px; border: 2px solid #0f8; display: none; pointer-events: none;
    }
    .label {
      position: absolute; background: rgba(0,0,0,0.6); color: #0ff; padding: 4px 10px;
      border-radius: 6px; font-size: 13px; pointer-events: none; transform: translate(-50%, -60px);
      white-space: nowrap;
    }
  </style>
</head>
<body>

  <div id="ui">
    W A S D → move • Q E → rotate • R F → up/down • Space → trade with nearest alien
  </div>
  <div id="inventory">Inventory:<br>Crystals: <span id="crystals">10</span><br>Rares: <span id="rares">0</span></div>
  <div id="trade-msg">Trade complete!</div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>

  <script>
    // ─── SCENE ──────────────────────────────────────────────────────
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x050014);

    const camera = new THREE.PerspectiveCamera(65, innerWidth / innerHeight, 0.1, 3000);
    camera.position.set(0, 10, 35);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    // Lights
    scene.add(new THREE.AmbientLight(0xffffff, 0.5));
    const light = new THREE.PointLight(0x88ccff, 3, 120);
    light.position.set(15, 30, 15);
    scene.add(light);

    // Floor / platform
    const floor = new THREE.Mesh(
      new THREE.CylinderGeometry(30, 30, 2, 48),
      new THREE.MeshStandardMaterial({ color: 0x112244, metalness: 0.7, roughness: 0.5 })
    );
    floor.rotation.x = Math.PI / 2;
    floor.position.y = -1;
    scene.add(floor);

    // ─── ALIENS ─────────────────────────────────────────────────────
    const aliens = [];
    const alienNames = ["Veil Matriarch", "Drift Nomad", "Crystal Oracle", "Void Enforcer", "Spear Huntress", "Nebula Trader"];
    const colors = [0x00ccff, 0x88ffee, 0xaaaaff, 0x3366ff, 0xff88cc, 0x88ffaa];

    for (let i = 0; i < 6; i++) {
      const group = new THREE.Group();

      // Body
      const bodyGeo = new THREE.CylinderGeometry(1.1, 1.8, 3.2, 12);
      const bodyMat = new THREE.MeshStandardMaterial({
        color: colors[i],
        emissive: colors[i],
        emissiveIntensity: 0.25
      });
      const body = new THREE.Mesh(bodyGeo, bodyMat);
      body.position.y = 1.2;
      group.add(body);

      // Head
      const head = new THREE.Mesh(
        new THREE.SphereGeometry(0.9, 16, 16),
        new THREE.MeshStandardMaterial({ color: 0x88ddff, emissive: 0x0044aa, emissiveIntensity: 0.5 })
      );
      head.position.y = 3.0;
      group.add(head);

      // Eyes
      const eyeGeo = new THREE.SphereGeometry(0.18, 12, 12);
      const eyeMat = new THREE.MeshBasicMaterial({ color: 0xffee00 });
      const eyeL = new THREE.Mesh(eyeGeo, eyeMat);
      eyeL.position.set(-0.35, 3.1, 0.7);
      group.add(eyeL);
      const eyeR = eyeL.clone();
      eyeR.position.x = 0.35;
      group.add(eyeR);

      // Start position
      const angle = i * (Math.PI * 2 / 6) + (Math.random() - 0.5) * 1.5;
      const dist = 10 + Math.random() * 10;
      group.position.set(Math.cos(angle) * dist, 1.6, Math.sin(angle) * dist);

      group.userData = {
        speed: 0.3 + Math.random() * 0.5,
        angle: Math.random() * Math.PI * 2,
        name: alienNames[i]
      };

      scene.add(group);
      aliens.push(group);

      // Name label
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = alienNames[i];
      document.body.appendChild(label);
      group.userData.label = label;
    }

    // ─── PLAYER INVENTORY ───────────────────────────────────────────
    let player = { crystals: 10, rares: 0 };

    function updateInventory() {
      document.getElementById('crystals').textContent = player.crystals;
      document.getElementById('rares').textContent = player.rares;
    }
    updateInventory();

    // ─── KEYBOARD CONTROLS ──────────────────────────────────────────
    const keys = {};
    window.addEventListener('keydown', e => { keys[e.key.toLowerCase()] = true; });
    window.addEventListener('keyup',   e => { keys[e.key.toLowerCase()] = false; });

    // Trade when pressing Space and close to an alien
    function tryTrade() {
      let closest = null;
      let minDist = Infinity;

      aliens.forEach(alien => {
        const dist = camera.position.distanceTo(alien.position);
        if (dist < minDist) {
          minDist = dist;
          closest = alien;
        }
      });

      if (minDist < 12) {   // trade range
        if (player.crystals >= 3) {
          player.crystals -= 3;
          player.rares += 1;
          updateInventory();

          const msg = document.getElementById('trade-msg');
          msg.textContent = `Traded with ${closest.userData.name}! +1 Rare`;
          msg.style.display = 'block';
          setTimeout(() => { msg.style.display = 'none'; }, 2800);
        } else {
          const msg = document.getElementById('trade-msg');
          msg.textContent = "Not enough crystals…";
          msg.style.display = 'block';
          setTimeout(() => { msg.style.display = 'none'; }, 2200);
        }
      }
    }

    // ─── ANIMATION LOOP ─────────────────────────────────────────────
    function animate() {
      requestAnimationFrame(animate);

      // Camera movement (keyboard only)
      const moveSpeed = 0.25;
      const rotSpeed = 0.025;

      if (keys['w']) camera.translateZ(-moveSpeed);
      if (keys['s']) camera.translateZ( moveSpeed);
      if (keys['a']) camera.translateX(-moveSpeed);
      if (keys['d']) camera.translateX( moveSpeed);
      if (keys['r']) camera.position.y += moveSpeed;
      if (keys['f']) camera.position.y -= moveSpeed;

      if (keys['q']) camera.rotation.y += rotSpeed;
      if (keys['e']) camera.rotation.y -= rotSpeed;

      // Auto-look at center-ish area
      const center = new THREE.Vector3(0, 2, 0);
      camera.lookAt(center);

      // Alien wandering
      aliens.forEach(alien => {
        alien.userData.angle += 0.006 * alien.userData.speed;
        alien.position.x += Math.cos(alien.userData.angle) * 0.04 * alien.userData.speed;
        alien.position.z += Math.sin(alien.userData.angle) * 0.04 * alien.userData.speed;

        const dist = Math.hypot(alien.position.x, alien.position.z);
        if (dist > 35) {
          alien.position.x *= 0.96;
          alien.position.z *= 0.96;
        }

        alien.rotation.y = alien.userData.angle * 0.4;

        // Update label
        const pos = alien.position.clone();
        pos.y += 5;
        const screenPos = pos.project(camera);
        const x = (screenPos.x * 0.5 + 0.5) * innerWidth;
        const y = (-screenPos.y * 0.5 + 0.5) * innerHeight;
        alien.userData.label.style.transform = `translate(${x}px, ${y}px)`;
      });

      // Trade input
      if (keys[' ']) {
        tryTrade();
        keys[' '] = false; // prevent holding space spamming
      }

      renderer.render(scene, camera);
    }

    animate();

    window.addEventListener('resize', () => {
      camera.aspect = innerWidth / innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
    });
  </script>
</body>
</html>
