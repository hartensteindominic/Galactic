<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sentinel Debug v3.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root { --neon: #00f2ff; --bg: #050505; --red: #ff3e3e; }
        body { background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; margin: 0; overflow: hidden; display: flex; align-items: center; justify-content: center; height: 100vh; }
        
        #canvas-container { width: 350px; height: 350px; border-radius: 50%; box-shadow: inset 0 0 50px var(--neon); }
        
        /* Debug Console Overlay */
        #debug-log { position: absolute; left: 20px; top: 20px; width: 250px; height: 80vh; font-size: 0.7rem; color: #555; overflow: hidden; pointer-events: none; }
        .log-entry { margin-bottom: 5px; border-left: 2px solid #222; padding-left: 5px; }
        .log-error { color: var(--red); border-color: var(--red); }
        
        .btn { background: transparent; border: 2px solid var(--neon); color: var(--neon); padding: 20px 50px; cursor: pointer; font-weight: bold; font-size: 1.2rem; transition: 0.3s; }
        .btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 30px var(--neon); }
        
        #webcam-view { position: absolute; bottom: 20px; right: 20px; width: 180px; height: 120px; background: #111; border: 1px solid #333; }
        video { width: 100%; height: 100%; object-fit: cover; filter: sepia(100%) hue-rotate(140deg) brightness(1.2); }
    </style>
</head>
<body>

<div id="debug-log"></div>
<div id="canvas-container"></div>
<div id="webcam-view"><video id="v" autoplay playsinline muted></video></div>
<button id="startBtn" class="btn">ACTIVATE AI CORE</button>

<script>
    const logger = document.getElementById('debug-log');
    function log(msg, isError = false) {
        const div = document.createElement('div');
        div.className = isError ? 'log-entry log-error' : 'log-entry';
        div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
        logger.prepend(div);
        console.log(msg);
    }

    let scene, camera, renderer, sphere;

    function init3D() {
        try {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(350, 350);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            const geo = new THREE.IcosahedronGeometry(1.5, 4);
            const mat = new THREE.MeshBasicMaterial({ color: 0x00f2ff, wireframe: true });
            sphere = new THREE.Mesh(geo, mat);
            scene.add(sphere);
            camera.position.z = 3.5;
            
            function render() {
                requestAnimationFrame(render);
                sphere.rotation.y += 0.01;
                if (window.speechSynthesis.speaking) {
                    let s = 1 + (Math.random() * 0.2);
                    sphere.scale.set(s,s,s);
                }
                renderer.render(scene, camera);
            }
            render();
            log("3D RENDERER INITIALIZED");
        } catch(e) { log("3D ERROR: " + e.message, true); }
    }

    function speak(txt) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(txt);
        utterance.pitch = 0.5;
        utterance.rate = 0.8;
        
        // Fix for Chrome: Voices must be loaded
        const voices = window.speechSynthesis.getVoices();
        if (voices.length > 0) utterance.voice = voices[0];
        
        window.speechSynthesis.speak(utterance);
        log("AI SPEAKING: " + txt);
    }

    async function start() {
        document.getElementById('startBtn').style.display = 'none';
        log("BOOT SEQUENCE INITIATED...");
        
        init3D();

        // Check Permissions
        try {
            log("REQUESTING SENSOR ACCESS...");
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            document.getElementById('v').srcObject = stream;
            log("VISION SENSORS ONLINE");
        } catch (err) {
            log("VISION ERROR: " + err.name, true);
            log("FIX: Run this on a local server or HTTPS!", true);
        }

        setTimeout(() => {
            speak("Sentinel online. Monitoring local environment for anomalies.");
        }, 1000);
    }

    // Pre-load voices for Chrome
    window.speechSynthesis.onvoiceschanged = () => log("VOICE ENGINE READY");
    document.getElementById('startBtn').onclick = start;
    
    log("SYSTEM STANDBY. AWAITING USER COMMAND.");
</script>
</body>
</html>
