<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AURUM SENTINEL // ZENITH_V4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #FFD700; font-family: 'Courier New', monospace; overflow: hidden; touch-action: manipulation; }
        #canvas-bg { position: fixed; top: 0; left: 0; z-index: -1; }
        .glass { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(15px); border: 1px solid rgba(255, 215, 0, 0.25); border-radius: 2px; }
        .gadget { position: absolute; padding: 10px; z-index: 20; transition: all 0.4s ease; }
        .main-vault { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 380px; padding: 25px; z-index: 50; border-top: 3px solid #FFD700; }
        .vault-btn { width: 100%; padding: 14px; font-weight: 900; font-size: 10px; text-transform: uppercase; cursor: pointer; border: 1px solid #FFD700; background: transparent; color: #FFD700; transition: 0.3s; }
        .vault-btn:hover:not(:disabled) { background: #FFD700; color: #000; box-shadow: 0 0 25px #FFD700; }
        .vault-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .status-dot { width: 6px; height: 6px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .pulse { animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.3; transform: scale(1.2); } }
        input { background: rgba(255,255,255,0.05) !important; border-bottom: 1px solid rgba(255,215,0,0.3) !important; color: white; }
        
        /* ðŸ”” TOAST SYSTEM */
        .toast { background: rgba(0, 0, 0, 0.9); border: 1px solid #FFD700; padding: 12px; color: #FFD700; font-size: 10px; min-width: 220px; animation: slideIn 0.3s ease-out; position: relative; }
        @keyframes slideIn { from { transform: translateX(120%); } to { transform: translateX(0); } }
        .progress-bar { height: 2px; background: #FFD700; width: 0%; transition: width 0.3s; margin-top: 8px; }
    </style>
</head>
<body>

<canvas id="canvas-bg"></canvas>
<div id="toast-container" class="fixed top-6 right-6 z-[100] space-y-3 pointer-events-none"></div>

<div class="gadget glass top-6 left-6 w-44">
    <div class="text-[7px] text-cyan-400 font-bold mb-1 tracking-widest uppercase">Security_Auditor</div>
    <div class="text-[9px] text-white font-bold">LIDO V3 Verified</div>
    <div class="flex items-center mt-1">
        <span class="status-dot bg-green-500 pulse"></span>
        <span class="text-[6px] text-green-400">SIGMA_PRIME_ACTIVE</span>
    </div>
</div>

<div class="gadget glass bottom-6 left-6 w-52">
    <div class="text-[7px] opacity-40 uppercase mb-2 tracking-widest border-b border-white/10 pb-1">Vizier_Rankings</div>
    <div id="leader-list" class="space-y-2 text-[8px]">
        <div class="animate-pulse text-white/20">FETCHING_LEDGER...</div>
    </div>
</div>

<div class="main-vault glass">
    <div class="flex justify-between items-center mb-6">
        <span class="text-[10px] font-black tracking-[0.3em]">ZENITH_PROTOCOL</span>
        <span id="sync-status" class="text-[7px] text-red-500 font-bold uppercase">No_Sync</span>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-8">
        <div class="p-2 bg-white/5">
            <span class="text-[6px] opacity-40 block uppercase">Wallet_ETH</span>
            <span id="user-eth" class="text-sm font-bold tracking-widest">0.0000</span>
        </div>
        <div class="p-2 bg-white/5 border-l-2 border-[#FFD700]">
            <span class="text-[6px] opacity-40 block uppercase">Staked_stETH</span>
            <span id="user-steth" class="text-sm font-bold tracking-widest text-[#FFD700]">0.0000</span>
        </div>
    </div>

    <div class="space-y-4">
        <input id="stake-input" type="number" step="0.1" placeholder="ENTER TRIBUTE AMOUNT" 
               class="w-full p-3 text-[11px] outline-none focus:border-[#FFD700] transition-all">
        
        <button id="btn-stake" onclick="stakeEth()" class="vault-btn font-black">Stake into Lido Core</button>
        
        <div class="pt-4 mt-2">
            <button onclick="withdrawExpress()" class="vault-btn border-cyan-500 text-cyan-400 hover:bg-cyan-500 hover:text-black">Express Bridge (0.0005 Tax)</button>
            <div id="ai-thought" class="mt-4 text-[7px] text-cyan-500 text-center italic uppercase tracking-tighter">"System Ready. Awaiting Signature."</div>
        </div>
    </div>
</div>

<script>
    const CONFIG = {
        TREASURY: "0x13B87B819252A81381C3Ce35e3Bd33199F4c6650",
        LIDO: "0xae7ab96520DE3A18E5e111B5EaAb095312D7fE84",
        ETHERSCAN_KEY: "FREE_KEY", // Ideally replace with your own
        FEE: "0.0005"
    };

    let signer = null;
    let provider = null;

    // --- ðŸŽ¨ 3D BACKGROUND ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas-bg'), alpha: true, antialias: false });
    renderer.setSize(window.innerWidth, window.innerHeight);
    const knot = new THREE.Mesh(new THREE.TorusKnotGeometry(13, 3.5, 120, 14), new THREE.MeshBasicMaterial({ color: 0xFFD700, wireframe: true, transparent: true, opacity: 0.1 }));
    scene.add(knot); camera.position.z = 45;
    function animate() { requestAnimationFrame(animate); knot.rotation.y += 0.002; renderer.render(scene, camera); } animate();

    // --- ðŸ“Ÿ TOAST SYSTEM ---
    function notify(msg, type = "info") {
        const container = document.getElementById('toast-container');
        const id = "toast-" + Date.now();
        const toast = document.createElement('div');
        toast.className = "toast pointer-events-auto";
        toast.innerHTML = `<div class="uppercase tracking-widest">[${type}]</div><div class="mt-1 opacity-80">${msg}</div><div class="progress-bar" id="${id}-p"></div>`;
        container.appendChild(toast);
        if(type === "processing") document.getElementById(`${id}-p`).style.width = "60%";
        else setTimeout(() => toast.remove(), 4000);
        return id;
    }

    // --- ðŸ”— WEB3 CORE ---
    async function syncSystem() {
        if (!window.ethereum) return speak("Neural link missing.");
        try {
            provider = new ethers.BrowserProvider(window.ethereum);
            const net = await provider.getNetwork();
            if (net.chainId !== 1n) {
                document.getElementById('sync-status').innerText = "WRONG_CHAIN";
                return speak("Switch to Ethereum Mainnet.");
            }
            const accounts = await provider.send("eth_requestAccounts", []);
            signer = await provider.getSigner();
            
            document.getElementById('sync-status').innerText = "SYNC_ACTIVE";
            document.getElementById('sync-status').className = "text-[7px] text-green-400 font-bold pulse";

            const ethBal = await provider.getBalance(accounts[0]);
            document.getElementById('user-eth').innerText = parseFloat(ethers.formatUnits(ethBal, "ether")).toFixed(4);

            const lido = new ethers.Contract(CONFIG.LIDO, ["function balanceOf(address) view returns (uint256)"], provider);
            const stEthBal = await lido.balanceOf(accounts[0]);
            document.getElementById('user-steth').innerText = parseFloat(ethers.formatUnits(stEthBal, "ether")).toFixed(4);
            
            updateRankings();
        } catch(e) { console.error(e); }
    }

    async function updateRankings() {
        try {
            const res = await fetch(`https://api.etherscan.io/api?module=account&action=txlist&address=${CONFIG.LIDO}&offset=3&sort=desc&apikey=${CONFIG.ETHERSCAN_KEY}`);
            const data = await res.json();
            if(data.status !== "1") return;
            const list = document.getElementById('leader-list');
            list.innerHTML = data.result.map((tx, i) => `
                <div class="flex justify-between ${i>0?'opacity-40':''}">
                    <span>${tx.from.slice(0,6)}...${tx.from.slice(-4)}</span>
                    <span class="${i===0?'text-[#FFD700]':''}">${parseFloat(ethers.formatUnits(tx.value, "ether")).toFixed(2)} ETH</span>
                </div>
            `).join('');
        } catch(e) {}
    }

    async function stakeEth() {
        const val = document.getElementById('stake-input').value;
        if(!val || val <= 0) return speak("Invalid tribute.");
        const tid = notify("Awaiting Signature", "pending");
        try {
            const contract = new ethers.Contract(CONFIG.LIDO, ["function submit(address) payable"], signer);
            const tx = await contract.submit(CONFIG.TREASURY, { value: ethers.parseEther(val) });
            document.getElementById(tid)?.remove();
            const pid = notify("Mining Transaction...", "processing");
            await tx.wait();
            document.getElementById(pid)?.remove();
            notify("Stake Confirmed", "success");
            syncSystem();
        } catch(e) { document.getElementById(tid)?.remove(); notify("Rejected", "error"); }
    }

    function speak(t) { document.getElementById('ai-thought').innerText = `"${t}"`; }

    window.onload = syncSystem;
</script>
</body>
</html>
