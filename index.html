<script>
    // ðŸ”‘ YOUR API KEY FROM THE SCREENSHOT
    const API_KEY = "YOUR_ACTUAL_API_KEY_HERE"; 

    document.getElementById('user-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') processRequest();
    });

    async function processRequest() {
        const inputField = document.getElementById('user-input');
        const prompt = inputField.value.trim();
        const spinner = document.getElementById('loading-spinner');
        
        if (!prompt) return;

        logToChat("Generating Manifest for: " + prompt);
        spinner.classList.remove('hidden');
        inputField.value = ""; 

        try {
            const code = await generateAutonomousCode(prompt);
            displayCode(code, prompt);
            logToChat("Success: Architecture Compiled.");
        } catch (err) {
            console.error(err);
            logToChat("Error: Transmission failed. Check API Key or Connection.");
        } finally {
            spinner.classList.add('hidden');
        }
    }

    async function generateAutonomousCode(topic) {
        // Using Gemini 1.5 Flash for speed and efficiency
        const ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
        
        const response = await fetch(ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ 
                    parts: [{ 
                        text: `Write a complete, high-quality, professional single-file HTML/CSS webpage for the following topic: "${topic}". 
                               Use modern CSS (Flexbox/Grid), include a navigation bar, a hero section, and responsive design. 
                               Return ONLY the raw HTML code. No markdown formatting, no backticks, no explanations.` 
                    }] 
                }],
                generationConfig: {
                    temperature: 0.7,
                    topP: 0.95,
                    maxOutputTokens: 4096,
                }
            })
        });

        const data = await response.json();
        
        if (data.error) {
            throw new Error(data.error.message);
        }

        let raw = data.candidates[0].content.parts[0].text;
        
        // Safety: Strip backticks if the model ignores instructions
        return raw.replace(/```html|```/g, "").trim();
    }

    function displayCode(code, topic) {
        const box = document.getElementById('chat-box');
        const container = document.createElement('div');
        container.className = "code-result";
        
        const launchBtn = document.createElement('button');
        launchBtn.className = "launch-btn";
        launchBtn.textContent = "ðŸš€ LAUNCH PREVIEW";
        launchBtn.onclick = () => {
            const win = window.open('', '_blank');
            win.document.write(code);
            win.document.close();
        };

        const downloadBtn = document.createElement('button');
        downloadBtn.className = "download-btn";
        downloadBtn.textContent = "ðŸ’¾ DOWNLOAD FILE";
        downloadBtn.onclick = () => {
            const blob = new Blob([code], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${topic.replace(/\s+/g, '_')}.html`;
            a.click();
        };

        container.appendChild(launchBtn);
        container.appendChild(downloadBtn);
        box.appendChild(container);
        box.scrollTop = box.scrollHeight;
    }

    function logToChat(msg) {
        const log = document.createElement('div');
        log.className = "ai-log";
        log.textContent = `> ${msg}`;
        document.getElementById('chat-box').appendChild(log);
        document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
    }

    // --- Starfield ---
    const canvas = document.getElementById('starfield');
    const ctx = canvas.getContext('2d');
    let stars = [];

    function init() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        stars = Array.from({length: 150}, () => ({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 1.5,
            speed: Math.random() * 0.5 + 0.1
        }));
    }

    function animate() {
        ctx.fillStyle = '#050505';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#fff';
        stars.forEach(s => {
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.size, 0, Math.PI*2);
            ctx.fill();
            s.y += s.speed;
            if(s.y > canvas.height) s.y = 0;
        });
        requestAnimationFrame(animate);
    }

    window.addEventListener('resize', init);
    init(); animate();
</script>
