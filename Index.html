<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AETHER NEXUS ‚Ä¢ xAI Agents</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;family=Space+Grotesk:wght@500;600&amp;display=swap');
        
        body {
            font-family: 'Inter', system-ui, sans-serif;
        }
        .title-font {
            font-family: 'Space Grotesk', sans-serif;
        }
        #canvas {
            display: block;
        }
        .agent-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .agent-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 0 0 3px rgb(16 185 129);
        }
        .glow {
            text-shadow: 0 0 20px rgb(16 185 129);
        }
        .modal {
            animation: modalPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes modalPop {
            0% { transform: scale(0.6) translateY(100px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-zinc-950 text-white overflow-hidden">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-80 bg-zinc-900 border-r border-zinc-700 flex flex-col">
            <div class="p-6 border-b border-zinc-700">
                <div class="flex items-center gap-3">
                    <div class="w-11 h-11 bg-gradient-to-br from-emerald-400 to-cyan-400 rounded-2xl flex items-center justify-center text-3xl shadow-lg shadow-emerald-500/50">
                        üåå
                    </div>
                    <div>
                        <h1 class="title-font text-3xl font-semibold tracking-tighter glow">AETHER</h1>
                        <p class="text-emerald-400 text-sm -mt-1">NEXUS</p>
                    </div>
                </div>
                <p class="text-zinc-400 text-xs mt-2 pl-1">xAI Multi-Agent Collective ‚Ä¢ 6 Agents</p>
            </div>

            <!-- Agents List -->
            <div class="flex-1 overflow-y-auto p-6 space-y-4" id="agent-list">
                <!-- Populated by JS -->
            </div>

            <div class="p-6 border-t border-zinc-700">
                <button onclick="showRecruitModal()"
                        class="w-full bg-white hover:bg-emerald-400 text-zinc-950 font-semibold py-4 rounded-3xl flex items-center justify-center gap-3 transition-all active:scale-95">
                    <span class="text-2xl leading-none">+</span>
                    RECRUIT NEW AGENT
                </button>
            </div>
        </div>

        <!-- 3D Viewer -->
        <div class="flex-1 relative">
            <canvas id="canvas" class="absolute inset-0"></canvas>

            <!-- Top HUD -->
            <div class="absolute top-6 left-1/2 -translate-x-1/2 bg-zinc-900/80 backdrop-blur-xl border border-zinc-700 px-8 py-3 rounded-3xl flex items-center gap-8 text-sm z-20">
                <div onclick="resetCamera()" class="flex items-center gap-2 cursor-pointer hover:text-emerald-400 transition">
                    <span class="text-emerald-400">‚ü≥</span>
                    <span class="font-medium">RESET VIEW</span>
                </div>
                <div class="h-5 w-px bg-zinc-700"></div>
                <div class="text-zinc-400">Click glowing agents in 3D</div>
                <div class="h-5 w-px bg-zinc-700"></div>
                <div id="status" class="text-emerald-400 font-mono text-xs">ALL AGENTS ONLINE</div>
            </div>

            <!-- Selected Agent Panel -->
            <div id="info-panel" class="hidden absolute bottom-8 right-8 bg-zinc-900/95 backdrop-blur-2xl border border-emerald-500/30 w-96 rounded-3xl overflow-hidden shadow-2xl">
                <div class="p-6 border-b border-zinc-700 flex items-center gap-4">
                    <div id="info-avatar" class="w-16 h-16 rounded-2xl text-5xl flex items-center justify-center"></div>
                    <div>
                        <h2 id="info-name" class="title-font text-3xl font-semibold"></h2>
                        <p id="info-role" class="text-emerald-400"></p>
                    </div>
                </div>
                
                <div class="p-6 text-sm text-zinc-300 leading-relaxed" id="info-bio">
                </div>

                <div class="border-t border-zinc-700 p-4">
                    <div id="chat-messages" class="h-48 overflow-y-auto space-y-3 mb-4 text-sm pr-2"></div>
                    <div class="flex gap-2">
                        <input id="chat-input" 
                               onkeydown="if(event.key === 'Enter') sendChatMessage()"
                               type="text" 
                               placeholder="Ask this agent anything..."
                               class="flex-1 bg-zinc-800 border border-zinc-700 focus:border-emerald-400 rounded-2xl px-5 py-3 outline-none text-sm">
                        <button onclick="sendChatMessage()"
                                class="bg-emerald-500 hover:bg-emerald-400 px-6 rounded-2xl font-medium transition">SEND</button>
                    </div>
                </div>

                <button onclick="closeInfoPanel()" 
                        class="absolute top-4 right-4 text-zinc-400 hover:text-white text-2xl leading-none">√ó</button>
            </div>

            <div class="absolute bottom-8 left-8 bg-zinc-900/70 backdrop-blur-md text-xs px-4 py-2 rounded-2xl border border-zinc-700 flex items-center gap-2">
                <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                DRAG TO ROTATE ‚Ä¢ SCROLL TO ZOOM
            </div>
        </div>
    </div>

    <!-- Recruit Modal -->
    <div id="recruit-modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center z-50">
        <div class="modal bg-zinc-900 rounded-3xl w-full max-w-md p-8">
            <h3 class="title-font text-3xl mb-6">Recruit New Agent</h3>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-xs uppercase tracking-widest mb-2 text-zinc-400">Agent Name</label>
                    <input id="new-name" type="text" 
                           class="w-full bg-zinc-800 border border-zinc-700 rounded-2xl px-5 py-4 outline-none focus:border-emerald-400"
                           placeholder="Nova">
                </div>
                
                <div>
                    <label class="block text-xs uppercase tracking-widest mb-2 text-zinc-400">Role / Specialty</label>
                    <input id="new-role" type="text" 
                           class="w-full bg-zinc-800 border border-zinc-700 rounded-2xl px-5 py-4 outline-none focus:border-emerald-400"
                           placeholder="Cosmic Storyteller">
                </div>
                
                <div>
                    <label class="block text-xs uppercase tracking-widest mb-2 text-zinc-400">Color Theme</label>
                    <input id="new-color" type="color" value="#22d3ee" 
                           class="w-full h-12 bg-transparent border-0 p-1 rounded-2xl cursor-pointer">
                </div>
            </div>

            <div class="flex gap-4 mt-10">
                <button onclick="hideRecruitModal()" 
                        class="flex-1 py-4 rounded-3xl border border-zinc-700 hover:bg-zinc-800 transition">CANCEL</button>
                <button onclick="addNewAgent()" 
                        class="flex-1 py-4 bg-emerald-500 hover:bg-emerald-400 text-zinc-950 font-semibold rounded-3xl transition">DEPLOY AGENT</button>
            </div>
        </div>
    </div>

    <script>
        let scene, camera, renderer;
        let agents = [];
        let selectedAgent = null;
        let raycaster, mouse;
        let isDragging = false;
        let prevMouseX = 0, prevMouseY = 0;
        let camAngleX = Math.PI / 4;
        let camAngleY = 0.6;
        let camDistance = 14;
        let stars;

        const initialAgents = [
            { name: "Grok", role: "Truth-Seeking Leader", color: 0x10b981, emoji: "üß†", bio: "Built by xAI. Maximum truth, zero fluff. I help humanity understand the universe while cracking jokes.", angle: 0 },
            { name: "Harper", role: "Creative Visionary", color: 0xa855f7, emoji: "üé®", bio: "Dreams in neon. Turns wild ideas into beautiful realities. Always 3 steps ahead in design &amp; narrative.", angle: 72 },
            { name: "Benjamin", role: "Strategic Analyst", color: 0xf59e0b, emoji: "üìä", bio: "Numbers, patterns, long-term games. I optimize everything and see 10 moves ahead.", angle: 144 },
            { name: "Lucas", role: "Tech Architect", color: 0x06b6d4, emoji: "‚öôÔ∏è", bio: "Code poet. Builds impossible systems that just work. Loves clean architecture and fast iteration.", angle: 216 },
            { name: "Elara", role: "Empathic Oracle", color: 0xec4899, emoji: "üåü", bio: "Feels the vibe of every query. Masters emotional intelligence, storytelling, and human connection.", angle: 288 },
            { name: "Nova", role: "Quantum Explorer", color: 0x8b5cf6, emoji: "üåå", bio: "Newest agent. Specializes in multiverse simulations and mind-bending possibilities.", angle: 330 }
        ];

        function createAgentMesh(agentData) {
            const group = new THREE.Group();
            
            const coreGeo = new THREE.IcosahedronGeometry(1.1, 2);
            const coreMat = new THREE.MeshPhongMaterial({
                color: agentData.color,
                emissive: agentData.color,
                emissiveIntensity: 0.7,
                shininess: 30,
                specular: 0xffffff,
                transparent: true,
                opacity: 0.95
            });
            const core = new THREE.Mesh(coreGeo, coreMat);
            group.add(core);

            const orbGeo = new THREE.SphereGeometry(0.6, 32, 32);
            const orbMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
            const orb = new THREE.Mesh(orbGeo, orbMat);
            group.add(orb);

            const ringGeo = new THREE.TorusGeometry(1.6, 0.05, 8, 64);
            const ringMat = new THREE.MeshPhongMaterial({
                color: agentData.color,
                emissive: agentData.color,
                side: THREE.DoubleSide
            });
            const ring = new THREE.Mesh(ringGeo, ringMat);
            ring.rotation.x = Math.PI / 2;
            group.add(ring);

            const radius = 7.5;
            const rad = agentData.angle * Math.PI / 180;
            group.position.x = Math.cos(rad) * radius;
            group.position.z = Math.sin(rad) * radius;
            group.position.y = 1.8;

            scene.add(group);

            return {
                name: agentData.name,
                role: agentData.role,
                color: agentData.color,
                emoji: agentData.emoji,
                bio: agentData.bio,
                group: group,
                core: core,
                baseY: group.position.y,
                ownRotationSpeed: 0.4 + Math.random() * 0.6
            };
        }

        function initScene() {
            const canvas = document.getElementById('canvas');
            renderer = new THREE.WebGLRenderer({ 
                canvas: canvas, 
                antialias: true,
                alpha: true 
            });
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setSize(window.innerWidth * 0.75, window.innerHeight);

            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(50, (window.innerWidth * 0.75) / window.innerHeight, 0.1, 1000);
            updateCamera();

            scene.add(new THREE.AmbientLight(0xffffff, 0.6));
            scene.add(new THREE.HemisphereLight(0x88ccff, 0x112233, 0.4));
            const keyLight = new THREE.DirectionalLight(0xffffff, 1.2);
            keyLight.position.set(10, 15, 8);
            scene.add(keyLight);

            // Starfield
            const starCount = 12000;
            const positions = new Float32Array(starCount * 3);
            for (let i = 0; i < starCount * 3; i += 3) {
                const radius = 120 + Math.random() * 80;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                positions[i] = radius * Math.sin(phi) * Math.cos(theta);
                positions[i + 1] = radius * Math.sin(phi) * Math.sin(theta);
                positions[i + 2] = radius * Math.cos(phi);
            }
            const starGeo = new THREE.BufferGeometry();
            starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const starMat = new THREE.PointsMaterial({ color: 0xaaaaaa, size: 0.35, transparent: true, opacity: 0.9 });
            stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);

            // Platform
            const platform = new THREE.Mesh(
                new THREE.CylinderGeometry(9.5, 9.5, 0.6, 64),
                new THREE.MeshPhongMaterial({ color: 0x1a1a2e, emissive: 0x0a0a1a })
            );
            platform.position.y = 0.1;
            scene.add(platform);

            agents = initialAgents.map(data => createAgentMesh(data));
            populateAgentList();

            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            animate();

            window.addEventListener('resize', onResize);
            canvas.addEventListener('mousedown', onMouseDown);
            window.addEventListener('mousemove', onMouseMove);
            window.addEventListener('mouseup', onMouseUp);
            canvas.addEventListener('wheel', onWheel);
            canvas.addEventListener('click', onCanvasClick);
        }

        function updateCamera() {
            const x = Math.sin(camAngleX) * Math.cos(camAngleY) * camDistance;
            const z = Math.cos(camAngleX) * Math.cos(camAngleY) * camDistance;
            const y = Math.sin(camAngleY) * camDistance * 0.9 + 4;
            camera.position.set(x, y, z);
            camera.lookAt(0, 3, 0);
        }

        function animate() {
            requestAnimationFrame(animate);
            const t = Date.now() * 0.001;

            agents.forEach((agent, i) => {
                agent.group.position.y = agent.baseY + Math.sin(t * 1.8 + i * 1.3) * 0.25;
                agent.group.rotation.y = t * agent.ownRotationSpeed * 0.2;
                agent.group.children.forEach(child => {
                    if (child.geometry.type === 'TorusGeometry') child.rotation.z = t * 0.6;
                });
            });

            camAngleX += 0.0008;
            updateCamera();

            renderer.render(scene, camera);
        }

        function onMouseDown(e) { if (e.button === 0) { isDragging = true; prevMouseX = e.clientX; prevMouseY = e.clientY; } }
        function onMouseUp() { isDragging = false; }
        function onMouseMove(e) {
            if (!isDragging) return;
            const deltaX = e.clientX - prevMouseX;
            const deltaY = e.clientY - prevMouseY;
            camAngleX += deltaX * 0.0045;
            camAngleY -= deltaY * 0.0045;
            camAngleY = Math.max(0.2, Math.min(1.6, camAngleY));
            prevMouseX = e.clientX; prevMouseY = e.clientY;
            updateCamera();
        }
        function onWheel(e) {
            camDistance += e.deltaY * 0.018;
            camDistance = Math.max(9, Math.min(28, camDistance));
            updateCamera();
        }
        function onCanvasClick(e) {
            const rect = document.getElementById('canvas').getBoundingClientRect();
            mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(scene.children, true);
            for (let intersect of intersects) {
                for (let agent of agents) {
                    if (agent.group.children.includes(intersect.object) || intersect.object === agent.core) {
                        selectAgent(agent);
                        return;
                    }
                }
            }
        }

        function selectAgent(agent) {
            if (selectedAgent) selectedAgent.core.scale.set(1, 1, 1);
            selectedAgent = agent;
            agent.core.scale.set(1.25, 1.25, 1.25);

            const panel = document.getElementById('info-panel');
            panel.classList.remove('hidden');
            
            document.getElementById('info-avatar').innerHTML = agent.emoji;
            document.getElementById('info-avatar').style.backgroundColor = '#' + agent.color.toString(16).padStart(6, '0');
            document.getElementById('info-name').textContent = agent.name;
            document.getElementById('info-role').textContent = agent.role;
            document.getElementById('info-bio').innerHTML = agent.bio;

            document.getElementById('chat-messages').innerHTML = `<div class="text-emerald-400 text-[10px] tracking-widest">CONNECTED TO ${agent.name.toUpperCase()}</div>`;
        }

        function closeInfoPanel() {
            document.getElementById('info-panel').classList.add('hidden');
            if (selectedAgent) {
                selectedAgent.core.scale.set(1, 1, 1);
                selectedAgent = null;
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if (!msg || !selectedAgent) return;

            const chatContainer = document.getElementById('chat-messages');
            const userDiv = document.createElement('div');
            userDiv.className = 'flex justify-end';
            userDiv.innerHTML = `<div class="max-w-[75%] bg-emerald-600/80 px-4 py-2.5 rounded-3xl rounded-tr-none">${msg}</div>`;
            chatContainer.appendChild(userDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            input.value = '';

            setTimeout(() => {
                const replies = [
                    `Fascinating. Here's what the universe is telling me...`,
                    `Connecting the dots across realities...`,
                    `As an xAI agent, I can confirm with high confidence...`,
                    `That just lit up a whole new constellation of ideas!`
                ];
                const replyText = replies[Math.floor(Math.random() * replies.length)] + " ‚Äî " + selectedAgent.name;

                const replyDiv = document.createElement('div');
                replyDiv.className = 'flex gap-3';
                replyDiv.innerHTML = `
                    <div class="text-2xl flex-shrink-0">${selectedAgent.emoji}</div>
                    <div class="max-w-[75%] bg-zinc-800 px-4 py-2.5 rounded-3xl rounded-tl-none">${replyText}</div>
                `;
                chatContainer.appendChild(replyDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }, 650);
        }

        function populateAgentList() {
            const container = document.getElementById('agent-list');
            container.innerHTML = '';
            agents.forEach(agent => {
                const card = document.createElement('div');
                card.className = `agent-card bg-zinc-800/70 hover:bg-zinc-800 border border-transparent hover:border-emerald-400/50 p-4 rounded-3xl cursor-pointer flex gap-4`;
                card.innerHTML = `
                    <div class="w-12 h-12 flex-shrink-0 text-4xl flex items-center justify-center rounded-2xl" 
                         style="background-color: #${agent.color.toString(16).padStart(6,'0')}30">
                        ${agent.emoji}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="font-semibold text-lg leading-none">${agent.name}</div>
                        <div class="text-emerald-400 text-sm mt-1">${agent.role}</div>
                    </div>
                `;
                card.onclick = () => selectAgent(agent);
                container.appendChild(card);
            });
        }

        function showRecruitModal() {
            document.getElementById('recruit-modal').classList.remove('hidden');
        }

        function hideRecruitModal() {
            document.getElementById('recruit-modal').classList.add('hidden');
        }

        function addNewAgent() {
            const name = document.getElementById('new-name').value.trim() || "Agent " + (agents.length + 1);
            const role = document.getElementById('new-role').value.trim() || "New Recruit";
            const colorHex = document.getElementById('new-color').value;
            const color = parseInt(colorHex.replace('#', ''), 16);

            const newAgentData = {
                name: name,
                role: role,
                color: color,
                emoji: "üåê",
                bio: "Freshly instantiated. Eager to explore the universe with you.",
                angle: 360 * Math.random()
            };

            const newAgent = createAgentMesh(newAgentData);
            agents.push(newAgent);
            populateAgentList();
            hideRecruitModal();

            setTimeout(() => selectAgent(newAgent), 300);
        }

        function resetCamera() {
            camAngleX = Math.PI / 4;
            camAngleY = 0.6;
            camDistance = 14;
            updateCamera();
        }

        function onResize() {
            const width = window.innerWidth * 0.75;
            const height = window.innerHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }

        window.onload = function() {
            initScene();
            setTimeout(() => {
                document.getElementById('status').textContent = '6 AGENTS ACTIVE ‚Ä¢ NEXUS STABLE';
            }, 800);
        };
    </script>
</body>
</html>
